drop table if exists user_progress;
drop table if exists questions;
drop table if exists subtopics;
drop table if exists topics;

create table topics (
  id bigint generated by default as identity primary key,
  name text not null,
  slug text not null,
  icon text
);

create table subtopics (
  id bigint generated by default as identity primary key,
  topic_id bigint references topics(id),
  name text not null
);

create table questions (
  id bigint generated by default as identity primary key,
  topic_id bigint references topics(id),
  subtopic_id bigint references subtopics(id),
  question_text text not null,
  options jsonb not null,
  correct_option integer not null,
  explanation text,
  trick_tip text
);

create table user_progress (
  id bigint generated by default as identity primary key,
  user_id text not null,
  question_id bigint references questions(id),
  is_correct boolean not null,
  answered_at timestamp with time zone default timezone('utc'::text, now())
);

insert into topics (name, slug, icon) values
('Legisla√ß√£o', 'legislacao', '‚öñÔ∏è'),
('Dire√ß√£o Defensiva', 'direcao-defensiva', 'üõ°Ô∏è'),
('Mec√¢nica B√°sica', 'mecanica', 'üîß'),
('Primeiros Socorros', 'socorros', 'üöë'),
('Meio Ambiente', 'meio-ambiente', 'üå≥'),
('Cidadania', 'cidadania', 'ü§ù');

insert into subtopics (topic_id, name) values
(1, 'Sinaliza√ß√£o de Tr√¢nsito'),
(1, 'Infra√ß√µes e Penalidades'),
(1, 'Processo de Habilita√ß√£o'),
(2, 'Condi√ß√µes Adversas'),
(2, 'Tipos de Colis√£o'),
(2, 'Cinto de Seguran√ßa'),
(3, 'Motor e Sistemas'),
(3, 'Painel de Instrumentos'),
(4, 'Avalia√ß√£o Inicial'),
(4, 'Hemorragias'),
(5, 'Polui√ß√£o Veicular'),
(6, 'Conv√≠vio Social no Tr√¢nsito');

insert into questions (topic_id, subtopic_id, question_text, options, correct_option, explanation, trick_tip) values
(1, 1, 'Diante da placa R-1 (Pare), o condutor deve:', '["Reduzir a velocidade e entrar", "Parar obrigatoriamente", "Dar prefer√™ncia e seguir", "Buzinar e avan√ßar"]', 1, 'A placa R-1 imp√µe parada total obrigat√≥ria do ve√≠culo.', 'N√£o confunda com "D√™ a Prefer√™ncia". Pare significa imobiliza√ß√£o total das rodas.'),
(1, 1, 'As placas de advert√™ncia t√™m a fun√ß√£o de:', '["Punir o condutor", "Alertar sobre perigos na via", "Indicar dist√¢ncias", "Regulamentar proibi√ß√µes"]', 1, 'Placas amarelas (advert√™ncia) servem para alertar sobre condi√ß√µes perigosas.', 'Regulamenta√ß√£o √© vermelho (proibi√ß√£o/obriga√ß√£o), Advert√™ncia √© amarelo (alerta).'),
(1, 2, 'Dirigir ve√≠culo segurando ou manuseando telefone celular √© infra√ß√£o:', '["M√©dia", "Grave", "Grav√≠ssima", "Leve"]', 2, 'O CTB define o uso de celular como infra√ß√£o grav√≠ssima.', 'Tudo que desvia muito a aten√ß√£o tende a ser grav√≠ssima.'),
(2, 4, 'O que √© aquaplanagem?', '["Perda de freio na descida", "Perda de contato dos pneus com o solo devido √† √°gua", "Motor superaquecido", "Falta de visibilidade na chuva"]', 1, 'Aquaplanagem √© quando o pneu flutua sobre uma camada de √°gua.', 'Lembre-se: Aqua (√°gua) + Planagem (planar/flutuar). N√£o freie bruscamente!'),
(3, 8, 'A luz vermelha com s√≠mbolo de bateria no painel indica:', '["Bateria carregada", "Problema no sistema de carga/alternador", "Falta de √°gua", "Porta aberta"]', 1, 'Indica que o alternador n√£o est√° carregando a bateria corretamente.', 'Luz vermelha no painel √© sempre alerta grave. Pare o carro.');